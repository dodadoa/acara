<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>acara | ascii canvas generator.</title>
  <link rel="stylesheet" type="text/css" href="/css/main.css">
  <link rel="stylesheet" type="text/css" href="/css/style.css">
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/a-color-picker@1.1.8/dist/acolorpicker.js"></script>
  <script type="text/javascript" src="/src/lib/figlet.js"></script>
</head>

<body>
  <div class="grid three">
    <div id="menu" class="cell1 menu">
      <div class="menu-flex-overflow-wrapper">
        <div class="menu-overflow-scroll-wrapper">
          <nav class="menu-flex">
            <div class="usage">
              <div><strong id="draw">d</strong><span>draw</span></div>
              <div>
                <strong class="hidden">x</strong>
                <span>text-color</span>
                <span id="text-color" class="selected-color text-color">
                  <div id="picker-text" class="picker hide" 
                    acp-color="#000000"
                    acp-show-alpha>
                  </div>
                </span>
              </div>
              <div>
                <strong class="hidden">x</strong>
                <span>drawBg</span>
                <span id="bg-color" class="selected-color bg-color">
                  <span id="text-color" class="selected-color text-color">
                    <div id="picker-bg" class="picker hide" 
                      acp-color="#ffffff"
                      acp-show-alpha>
                    </div>
                  </span>
                </span>
              </div>
              <div>
                <strong id="cursorMode">c</strong><span>cursor</span>
                <p id="cursor-type">guide</p>
              </div>
              <div><strong id="erase">e</strong><span>erase</span></div>
            </div>
            <hr>
  
            <div class="icon-title-wrapper">
              <svg class="icon" width="24px" height="24px" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg" aria-labelledby="gridLargeIconTitle" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" color="#000000"> 
                <title id="gridLargeIconTitle">Large Grid</title> 
                <rect width="7" height="7" x="3" y="3"/> <rect width="7" height="7" x="14" y="3"/>
                <rect width="7" height="7" x="3" y="14"/> <rect width="7" height="7" x="14" y="14"/> 
              </svg>
              <strong id="charlist-title" class=" action-button">characters</strong>
            </div>
            <div id="chars" class="char-table collapse"></div>
  
            <hr>
            <div>
              <div class="icon-title-wrapper">
                <svg class="icon" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M0 4.75C0 3.784.784 3 1.75 3h20.5c.966 0 1.75.784 1.75 1.75v14.5A1.75 1.75 0 0122.25 21H1.75A1.75 1.75 0 010 19.25V4.75zm1.75-.25a.25.25 0 00-.25.25v14.5c0 .138.112.25.25.25h20.5a.25.25 0 00.25-.25V4.75a.25.25 0 00-.25-.25H1.75z"/><path fill-rule="evenodd" d="M5 8.75A.75.75 0 015.75 8h11.5a.75.75 0 010 1.5H5.75A.75.75 0 015 8.75zm0 4a.75.75 0 01.75-.75h5.5a.75.75 0 010 1.5h-5.5a.75.75 0 01-.75-.75z"/></svg>
                <strong id="generator-title">generator</strong>
              </div>

              <form id="generator-form" class="generator-form collapse">
                <label for="title">title</label><br>
                <input type="text" id="title" name="title" value="Sonic Thread III"><br>
                <label for="artists">Artists</label><br>
                <input type="text" id="artists" name="artists" value="CRSCRSCRS, Alex McLean, Kindohm"><br>
                <label for="location">Location</label><br>
                <input type="text" id="location" name="location" value="Tentacles Workshop"><br>
                <label for="dates">Dates</label><br>
                <input type="text" id="dates" name="dates" value="Sept 9 â€“ Oct 30, 2021"><br>
                <label for="times">Times</label><br>
                <input type="text" id="times" name="times" value="17.00 ~ 19.00"><br>
                <label for="notes">Notes</label><br>
                <input type="text" id="notes" name="notes" value="Free Entry"><br>
                <div class="fontname">
                  <div>fontname</div>
                  <select name="fontname" id="fontname"></select>
                </div>
  
                <div>
                  <button id="generate" type="submit">generate</button>
                  <button id="download" type="download">download</button>
                  <button id="reset">reset</button>
                </div>
              </form>
  
              <hr>
              <div>
                <div class="icon-title-wrapper">
                  <svg class="icon" width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.48 18.5368H21M4.68 12L3 12.044M4.68 12C4.68 13.3255 5.75451 14.4 7.08 14.4C8.40548 14.4 9.48 13.3255 9.48 12C9.48 10.6745 8.40548 9.6 7.08 9.6C5.75451 9.6 4.68 10.6745 4.68 12ZM10.169 12.0441H21M12.801 5.55124L3 5.55124M21 5.55124H18.48M3 18.5368H12.801M17.88 18.6C17.88 19.9255 16.8055 21 15.48 21C14.1545 21 13.08 19.9255 13.08 18.6C13.08 17.2745 14.1545 16.2 15.48 16.2C16.8055 16.2 17.88 17.2745 17.88 18.6ZM17.88 5.4C17.88 6.72548 16.8055 7.8 15.48 7.8C14.1545 7.8 13.08 6.72548 13.08 5.4C13.08 4.07452 14.1545 3 15.48 3C16.8055 3 17.88 4.07452 17.88 5.4Z" stroke="#363853" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <strong id="setting" class="action-button">setting</strong>
                </div>
                <div id="setting-section" class="setting collapse">
                  
                  <div class="input-size">
                    <div class="setting-size-input">
                      <div>
                        <label for="width">Width</label>
                        <input type="text" id="width" name="width" value="500"><br>
                      </div>
                      <div>
                        <label for="height">Height</label>
                        <input type="text" id="height" name="height" value="700"><br>
                      </div>
                      <div>
                        <label for="font-size">font-size</label>
                        <input type="text" id="font-size" name="font-size" value="12px"><br>
                      </div>
                    </div>
                    <div class="setting-btn">
                      <button id="resize-canvas">resize</button>
                      <button id="clear-canvas">clear</button>
                    </div>
                  </div>
  
                </div>
              </div>

              <hr>
              <div>
                <div class="icon-title-wrapper mb-4">
                  <svg
                    class="icon"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M6 6C6 5.44772 6.44772 5 7 5H17C17.5523 5 18 5.44772 18 6C18 6.55228 17.5523 7 17 7H7C6.44771 7 6 6.55228 6 6Z"
                      fill="currentColor"
                    />
                    <path
                      d="M6 10C6 9.44771 6.44772 9 7 9H17C17.5523 9 18 9.44771 18 10C18 10.5523 17.5523 11 17 11H7C6.44771 11 6 10.5523 6 10Z"
                      fill="currentColor"
                    />
                    <path
                      d="M7 13C6.44772 13 6 13.4477 6 14C6 14.5523 6.44771 15 7 15H17C17.5523 15 18 14.5523 18 14C18 13.4477 17.5523 13 17 13H7Z"
                      fill="currentColor"
                    />
                    <path
                      d="M6 18C6 17.4477 6.44772 17 7 17H11C11.5523 17 12 17.4477 12 18C12 18.5523 11.5523 19 11 19H7C6.44772 19 6 18.5523 6 18Z"
                      fill="currentColor"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M2 4C2 2.34315 3.34315 1 5 1H19C20.6569 1 22 2.34315 22 4V20C22 21.6569 20.6569 23 19 23H5C3.34315 23 2 21.6569 2 20V4ZM5 3H19C19.5523 3 20 3.44771 20 4V20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V4C4 3.44772 4.44771 3 5 3Z"
                      fill="currentColor"
                    />
                  </svg>
                  <strong id="about-section" class="action-button">about</strong>
                </div>
                <div id="about" class="about">
                  <span>
                    <p><strong>acara</strong>, an (a)scii (ca)nvas gene(ra)tor and small sketch tool. easy to create custom, web-based design tools that export design assets right in your browser. written in plain javascript.  </p>
                    <br>
                    <a href="https://github.com/karnpapon/acara">
                      <p>GitHub</p>
                    </a>
                  </span>
  
                </div>
              </div>
  
  
            </div>
  
          </nav>
        </div>
      </div>

    </div>
    <!-- <pre id="output" class="cell2 output"></pre> -->
    <canvas id="output" class="cell2 output"></canvas>
  </div>

  </div>
  <script type="module">
    import { run } from '/src/run.js'
    import * as prog0 from '/src/programs/draw.js'
    import Char, { charsList } from '/src/modules/chars.js'

    const fontSelector = document.getElementById('fontname')

    let fontname;
    let httpRequest = new XMLHttpRequest(); 
    httpRequest.open("GET", "fontlists.json", true);
    httpRequest.send();
    httpRequest.addEventListener("readystatechange", function() {
        if (this.readyState === this.DONE) {
          fontname = JSON.parse(this.response);
          for(let i=0; i<fontname.data.length;i++){
            const opt = document.createElement("option")
            opt.value = fontname.data[i]
            opt.label = fontname.data[i]
            if(fontname.data[i] === "Standard") { opt.selected = true }
            fontSelector.appendChild(opt)
          }
        }
    });

    fontSelector.onchange = (e) => {
      window.dispatchEvent(new CustomEvent('fontselect', { detail: e.target.value}))
      e.preventDefault()
    }

    figlet.defaults({ fontPath: '/fonts' });
    figlet.preloadFonts(["Standard"], () => {
      console.log("FIGlet loaded!")

      const character = new Char();

      const output = document.getElementById('output')
      const chartable = document.getElementById("chars")
      const resizeBtn = document.getElementById("resize-canvas")
      const clearBtn = document.getElementById("clear-canvas")
      const charListTitle = document.getElementById("charlist-title")
      const settingBtn = document.getElementById("setting")
      const generatorSectionTitle = document.getElementById("generator-title")
      const settingSection = document.getElementById("setting-section")
      const aboutSectionTitle = document.getElementById("about-section")
      const menu = document.getElementById("menu")
      const drawBtn = document.getElementById("draw")
      const downloadBtn = document.getElementById("download")
      const resetBtn = document.getElementById("reset")
      const form = document.getElementById("generator-form")
      const about = document.getElementById("about")
      const pickerTextColor = document.getElementById("picker-text")
      const pickerBgColor = document.getElementById("picker-bg")
      const selectTextColorBtn = document.getElementById("text-color")
      const selectBgColorBtn = document.getElementById("bg-color")

      charListTitle.onclick = () => { chartable.classList.toggle("collapse") }
      settingBtn.onclick = () => { settingSection.classList.toggle("collapse") }
      generatorSectionTitle.onclick = () => { form.classList.toggle("collapse") }
      aboutSectionTitle.onclick = () => { about.classList.toggle("collapse") }
      selectTextColorBtn.onclick = () => { pickerTextColor.classList.toggle("hide") }
      selectBgColorBtn.onclick = () => { pickerBgColor.classList.toggle("hide") }

      AColorPicker.from(pickerTextColor)
        .on('change', (picker, color) => {
          selectTextColorBtn.style.backgroundColor = color;
          window.dispatchEvent(new CustomEvent('select-text-color', { detail: { color }})) 
        })
        // .on('coloradd', (picker, color) => { })

      AColorPicker.from(pickerBgColor)
        .on('change', (picker, color) => {
          selectBgColorBtn.style.backgroundColor = color;
          window.dispatchEvent(new CustomEvent('select-bg-color', { detail: { color }})) 
        })

      resetBtn.onclick = (e) => {
        window.dispatchEvent(new Event('reset'))
        e.preventDefault()
      }
      downloadBtn.onclick = (e) => {
        window.dispatchEvent(new Event('download'))
        e.preventDefault()
      }
      resizeBtn.onclick = (e) => {
        const w = document.getElementById("width").value
        const h = document.getElementById("height").value
        const fsize = document.getElementById("font-size").value
        window.dispatchEvent(new CustomEvent('resize-canvas', { detail: { w,h,fsize }}))
        e.preventDefault()
      }
      clearBtn.onclick = (e) => {
        window.dispatchEvent(new CustomEvent('clear-canvas'))
        e.preventDefault()
      }

      form.onsubmit = (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = {
          title: formData.get("title"),
          artists: formData.get("artists"),
          location: formData.get("location"),
          dates: formData.get("dates"),
          times: formData.get("times"),
          notes: formData.get("notes"),
          width: formData.get("width"),
          height: formData.get("height"),
        }

        window.dispatchEvent(new CustomEvent('generate', { detail: data }));
      }

      run(prog0, { element: output })
        .catch(errorHandler)
        .then((res) => {
          menu.className = "menu ready"
          charsList.map(char => {
            let c = document.createElement("p")
            c.innerText = char
            c.addEventListener("click", () => {
              character.selectChar(char)
            })
            chartable.appendChild(c)
          })

          drawBtn.setAttribute("data-usage", "draw")
        })

      function errorHandler(e) {
        console.warn(e.message)
        console.log(e.error)
      }
    });


  </script>
</body>

</html>