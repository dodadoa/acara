<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>ascii poster generator</title>
  <link rel="stylesheet" type="text/css" href="/css/main.css">
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.min.js"></script>
  <script type="text/javascript" src="/src/lib/figlet.js"></script>
  <style type="text/css" media="screen">
    /* Reset */

    * {
      margin: 0;
      padding: 0;
      border: 0;
      outline: 0;
      text-decoration: none;
      font-weight: inherit;
      font-style: inherit;
      color: inherit;
      font-size: 100%;
      font-family: inherit;
      vertical-align: baseline;
      list-style: none;
      border-collapse: collapse;
      border-spacing: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    strong {
      font-weight: bolder;
    }

    body {
      background-color: rgb(242 242 242);
      margin: 0;
      padding: 0;
    }

    hr {
      width: 100%;
      border: 0.5px solid #a4a4a4;
      margin-bottom: 1.25rem;    
      margin-top: 1.25rem;
    }

    canvas,
    pre {
      font-family: 'JetBrainsMono Nerd Font Mono';
      line-height: 1;
      position: absolute;
      left: 0;
      top: 0;
      margin: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      cursor: none;
      margin-top: 20px;
      font-size: 12px;
      /* background-color: red; */
    }

    button {
      cursor: pointer;
    }

    button:hover {
      opacity: 0.5;
    }

    .icon {
      width: 45px;
      margin-right: 0.5rem;
    }

    .icon-title-wrapper {
      display: flex;
      align-items: center;
      width: 100%;
    }

    .mb-4 {
      margin-bottom: 1rem;
    }

    /* -- main grid layout ---------------------------------------------- */

    .grid {
      display: grid;
      width: 100%;
      position: relative;
    }

    .cell1,
    .cell3 {
      height: 100vh;
    }

    .cell1,
    .cell2,
    .cell3 {
      position: relative;
    }

    .cell1 {
      /* width: 30%; */
    }

    .cell2 {
      /* width: 80%; */
    }

    .grid.one {
      grid-template-columns: 1fr;
    }

    .grid.one .cell2,
    .grid.one .cell3 {
      display: none;
    }

    .grid.two {
      grid-template-columns: 1fr 1fr;
    }

    .grid.two .cell3 {
      display: none;
    }

    .grid.three {
      grid-template-columns: 1fr 3fr auto;
    }

    /* -- menu ---------------------------------------------------------- */

    .menu {
      font-weight: 100;
      background-color: rgba(255, 255, 255, 0);
      color: black;
      opacity: 0;
      transition: 200ms;
      padding: 20px;
      height: calc(100vh - 40px);
      /* padding: 0 1ch 0  1ch; */
      /* overflow-y: scroll; */
      /* border-left: 1px solid #222222; */
    }

    .menu-flex-overflow-wrapper {
      height: calc(100vh - 40px);
      width: 100%;
      /* width: calc(100% + 35px); */
      overflow: hidden;
      /* background-color: beige; */
    }

    .menu-overflow-scroll-wrapper {
      width: calc(100% + 15px);
      overflow-y: scroll;
      height: 100%;
    }

    .menu-flex {
      display: flex;
      flex-direction: column;
      font-weight: initial;
      font-family: 'JetBrainsMono Nerd Font Mono';
      font-size: 0.8rem;
      line-height: 1.5rem;
      padding: 2rem;
      padding-right: 4rem;
      height: 100%;
      padding-bottom: 1rem;
    }

    .menu-flex:last-child {
      box-sizing: border-box;
    }

    .usage div {
      margin-bottom: 4px;
    }

    .usage strong {
      font-weight: bolder;
      background-color: white;
      padding: 4px;
      color: black;
      border-radius: 4px;
      margin-right: 0.5rem;
      text-decoration: none;
    }

    .level2,
    .hotkey {
      color: #666;
    }

    .action-button {
      cursor: pointer;
      width: 100%;
    }

    .action-button:hover {
      text-decoration: underline;
    }

    .row-wrap {
      display: contents;
    }

    .program-cathegory {
      color: #666;
      padding-left: 2ch;
      display: block;
    }

    .project-grid a {
      color: pink !important;
      padding-left: 4ch;
    }

    /* .ruler {
      grid-column: span 2;
    } */

    /* .ruler {
      border-bottom: 1px solid rgb(181, 181, 181);
      padding: 1rem 0;
    } */

    .menu-flex a {
      color: inherit;
      text-decoration: none;
    }

    /* -------------- form ---------- */
    .generator-form {
      margin-top: 1rem;
      width: 100%;
      padding-bottom: 25rem;
      height: 0;
      display: flex;
      flex-wrap: wrap;
      overflow: hidden;
      transition: 200ms;
    }

    .generator-form input {
      color: black;
      width: 100%;
      padding: 4px;
    }

    .generator-form button {
      color: black;
      padding: 0.5rem;
      margin-top: 0.5rem;
    }

    .generator-form .input-size {
      width: 50%;
      display: flex;
    }

    /* ---------- setting------- */
    .setting {
      width: 100%;
      padding-bottom: 7rem;
      height: 0;
      display: flex;
      flex-wrap: wrap;
      overflow: hidden;
      transition: 200ms;
      margin-top: 0.5rem;
    }

    .input-size input {
      padding: 8px;
      width:  80%;
    }

    .setting-btn > button {
      padding: 8px;
      margin-right: 8px;
    }
    
    .setting-btn {
      display: flex;
      margin-top: 1.5rem;
    }

    .setting-size-input{
      margin-bottom: 8px;
      display: flex;
    }

    .setting-size-input > div {
      margin-right: 4px;
    }

    /* ----------char table---------- */
    .char-table {
      width: 100%;
      padding-bottom: 33rem;
      height: 0;
      display: flex;
      flex-wrap: wrap;
      overflow: hidden;
      transition: 200ms;
      margin-top: 0.5rem;
    }

    .ready {
      opacity: 1;
    }

    .char-table p {
      padding: 0px 4px;
      cursor: pointer;
      user-select: none;
    }

    .char-table p:hover {
      background-color: rgba(103, 103, 103, 0.5);
    }

    .usage strong[data-usage="draw"] {
      background-color: #aaff66;
      color: #00cc55;
    }

    .usage strong[data-usage="erase"] {
      background-color: #eeee77;
      color: #00cc55;
    }

    .usage strong[data-usage="drawBg"] {
      background-color: #b0b0b0;
      color: #696969;
    }

    .usage strong[data-usage="drawTextColor"] {
      background-color: #344ffa;
      color: #e2e2e2;
    }

    .usage strong[data-usage="cursorMode"] {
      background-color: #34e6fa;
      color: #000000;
    }

    /* ---------- about ----------- */

    .about {
      width: 100%;
      padding-bottom: 20rem;
      height: 0;
      display: flex;
      flex-wrap: wrap;
      overflow: hidden;
      transition: 200ms;
      margin-top: 0.5rem;
    }

    .about > div > a { 
      text-decoration: underline;
      width: fit-content;
      font-weight: bolder;
    }
    .about > div > a:hover { 
      text-decoration: none;
    }

    /* ------id------------------- */

    #charlist-title {
      cursor: pointer;
      user-select: none;
    }

    #generate, #resize-canvas {
      /* background-color: #00cc55; */
      background-color: black;
      color: white;
    }

    #reset {
      /* background-color: #ff8b50; */
      /* background-color: #c9c9c9; */
    }

    #download {
      background-color: white;
    }

    #fontname { 
      width: 100%;
      padding: 4px;
      margin-bottom: 1rem;
    }

    #generator-title, #setting, #about-section {
      cursor: pointer;
      user-select: none;
    }

    #generator-title:hover{
      text-decoration: underline;
    }

    .fontname { margin-top: 0.25rem; width: 100%;}

    .collapse {
      padding-bottom: 0;
      margin: 0;
    }
  </style>
</head>

<body>
  <div class="grid three">
    <div id="menu" class="cell1 menu">
      <div class="menu-flex-overflow-wrapper">
        <div class="menu-overflow-scroll-wrapper">
          <nav class="menu-flex">
            <div class="usage">
              <div><strong id="draw">d</strong><span>draw</span></div>
              <div><strong id="drawTextColor">t</strong><span>drawTextColor</span></div>
              <div><strong id="drawBg">b</strong><span>drawBg</span></div>
              <div><strong id="cursorMode">c</strong><span>cursor</span></div>
              <div><strong id="erase">e</strong><span>erase</span></div>
            </div>
            <hr>
  
            <div class="icon-title-wrapper">
              <svg class="icon" width="24px" height="24px" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg" aria-labelledby="gridLargeIconTitle" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" color="#000000"> 
                <title id="gridLargeIconTitle">Large Grid</title> 
                <rect width="7" height="7" x="3" y="3"/> <rect width="7" height="7" x="14" y="3"/>
                <rect width="7" height="7" x="3" y="14"/> <rect width="7" height="7" x="14" y="14"/> 
              </svg>
              <strong id="charlist-title" class=" action-button">characters</strong>
            </div>
            <div id="chars" class="char-table collapse"></div>
  
            <hr>
            <div>
              <div class="icon-title-wrapper">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                  width="35px" height="35px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">
                  <path d="M78,36H38c-1.1,0-2-0.9-2-2v-4c0-1.1,0.9-2,2-2H78c1.1,0,2,0.9,2,2v4C80,35.1,79.1,36,78,36z"/>
                  <path d="M78,54H38c-1.1,0-2-0.9-2-2v-4c0-1.1,0.9-2,2-2H78c1.1,0,2,0.9,2,2v4C80,53.1,79.1,54,78,54z"/>
                  <path d="M26,54h-4c-1.1,0-2-0.9-2-2v-4c0-1.1,0.9-2,2-2h4c1.1,0,2,0.9,2,2v4C28,53.1,27.1,54,26,54z"/>
                  <path d="M26,36h-4c-1.1,0-2-0.9-2-2v-4c0-1.1,0.9-2,2-2h4c1.1,0,2,0.9,2,2v4C28,35.1,27.1,36,26,36z"/>
                  <path d="M26,72h-4c-1.1,0-2-0.9-2-2v-4c0-1.1,0.9-2,2-2h4c1.1,0,2,0.9,2,2v4C28,71.1,27.1,72,26,72z"/>
                  <path d="M78,72H38c-1.1,0-2-0.9-2-2v-4c0-1.1,0.9-2,2-2H78c1.1,0,2,0.9,2,2v4C80,71.1,79.1,72,78,72z"/>
                </svg>
                <strong id="generator-title">generator</strong>
              </div>

              <form id="generator-form" class="generator-form">
                <label for="title">title</label><br>
                <input type="text" id="title" name="title" value="Sonic Thread III"><br>
                <label for="artists">Artists</label><br>
                <input type="text" id="artists" name="artists" value="CRSCRSCRS, Alex McLean, Kindohm"><br>
                <label for="location">Location</label><br>
                <input type="text" id="location" name="location" value="Tentacles Workshop"><br>
                <label for="dates">Dates</label><br>
                <input type="text" id="dates" name="dates" value="Sept 9 – Oct 30, 2021"><br>
                <label for="times">Times</label><br>
                <input type="text" id="times" name="times" value="17.00 ~ 19.00"><br>
                <label for="notes">Notes</label><br>
                <input type="text" id="notes" name="notes" value="Free Entry"><br>
                <div class="fontname">
                  <div>fontname</div>
                  <select name="fontname" id="fontname"></select>
                </div>
  
                <div>
                  <button id="generate" type="submit">generate</button>
                  <button id="download" type="download">download</button>
                  <button id="reset">reset</button>
                </div>
              </form>
  
              <hr>
              <div>
                <div class="icon-title-wrapper">
                  <svg class="icon" width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.48 18.5368H21M4.68 12L3 12.044M4.68 12C4.68 13.3255 5.75451 14.4 7.08 14.4C8.40548 14.4 9.48 13.3255 9.48 12C9.48 10.6745 8.40548 9.6 7.08 9.6C5.75451 9.6 4.68 10.6745 4.68 12ZM10.169 12.0441H21M12.801 5.55124L3 5.55124M21 5.55124H18.48M3 18.5368H12.801M17.88 18.6C17.88 19.9255 16.8055 21 15.48 21C14.1545 21 13.08 19.9255 13.08 18.6C13.08 17.2745 14.1545 16.2 15.48 16.2C16.8055 16.2 17.88 17.2745 17.88 18.6ZM17.88 5.4C17.88 6.72548 16.8055 7.8 15.48 7.8C14.1545 7.8 13.08 6.72548 13.08 5.4C13.08 4.07452 14.1545 3 15.48 3C16.8055 3 17.88 4.07452 17.88 5.4Z" stroke="#363853" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <strong id="setting" class="action-button">setting</strong>
                </div>
                <div id="setting-section" class="setting collapse">
                  
                  <div class="input-size">
                    <div class="setting-size-input">
                      <div>
                        <label for="width">Width</label>
                        <input type="text" id="width" name="width" value="500"><br>
                      </div>
                      <div>
                        <label for="height">Height</label>
                        <input type="text" id="height" name="height" value="700"><br>
                      </div>
                      <div>
                        <label for="font-size">font-size</label>
                        <input type="text" id="font-size" name="font-size" value="12px"><br>
                      </div>
                    </div>
                    <div class="setting-btn">
                      <button id="resize-canvas">resize</button>
                      <button id="clear-canvas">clear</button>
                    </div>
                  </div>
  
                </div>
              </div>

              <hr>
              <div>
                <div class="icon-title-wrapper mb-4">
                  <svg class="icon" width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.48 18.5368H21M4.68 12L3 12.044M4.68 12C4.68 13.3255 5.75451 14.4 7.08 14.4C8.40548 14.4 9.48 13.3255 9.48 12C9.48 10.6745 8.40548 9.6 7.08 9.6C5.75451 9.6 4.68 10.6745 4.68 12ZM10.169 12.0441H21M12.801 5.55124L3 5.55124M21 5.55124H18.48M3 18.5368H12.801M17.88 18.6C17.88 19.9255 16.8055 21 15.48 21C14.1545 21 13.08 19.9255 13.08 18.6C13.08 17.2745 14.1545 16.2 15.48 16.2C16.8055 16.2 17.88 17.2745 17.88 18.6ZM17.88 5.4C17.88 6.72548 16.8055 7.8 15.48 7.8C14.1545 7.8 13.08 6.72548 13.08 5.4C13.08 4.07452 14.1545 3 15.48 3C16.8055 3 17.88 4.07452 17.88 5.4Z" stroke="#363853" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <strong id="about-section" class="action-button">about</strong>
                </div>
                <div id="about" class="about collapse">
                  <div>
                    <p>ASCII (American Standard Code for Information Interchange) is the most common character encoding format for text data in computers and on the internet. In standard ASCII-encoded data, there are unique values for 128 alphabetic, numeric or special additional characters and control codes.</p>
                    <br>
                    <a href="https://github.com/karnpapon">
                      <p>GitHub</p>
                    </a>
                  </div>
  
                </div>
              </div>
  
  
            </div>
  
          </nav>
        </div>
      </div>

    </div>
    <!-- <pre id="output" class="cell2 output"></pre> -->
    <canvas id="output" class="cell2 output"></canvas>
  </div>

  </div>
  <script type="module">
    import { run } from '/src/run.js'
    import * as prog0 from '/src/programs/draw.js'
    import Char, { charsList } from '/src/modules/chars.js'

    const fontSelector = document.getElementById('fontname')

    let fontname;
    let httpRequest = new XMLHttpRequest(); 
    httpRequest.open("GET", "fontlists.json", true);
    httpRequest.send();
    httpRequest.addEventListener("readystatechange", function() {
        if (this.readyState === this.DONE) {
          fontname = JSON.parse(this.response);
          for(let i=0; i<fontname.data.length;i++){
            const opt = document.createElement("option")
            opt.value = fontname.data[i]
            opt.label = fontname.data[i]
            if(fontname.data[i] === "Standard") { opt.selected = true }
            fontSelector.appendChild(opt)
          }
        }
    });

    fontSelector.onchange = (e) => {
      window.dispatchEvent(new CustomEvent('fontselect', { detail: e.target.value}))
      e.preventDefault()
    }

    figlet.defaults({ fontPath: '/fonts' });
    figlet.preloadFonts(["Standard"], () => {
      console.log("FIGlet loaded!")

      const character = new Char();

      const output = document.getElementById('output')
      const chartable = document.getElementById("chars")
      const resizeBtn = document.getElementById("resize-canvas")
      const clearBtn = document.getElementById("clear-canvas")
      const charListTitle = document.getElementById("charlist-title")
      const settingBtn = document.getElementById("setting")
      const generatorSectionTitle = document.getElementById("generator-title")
      const settingSection = document.getElementById("setting-section")
      const aboutSectionTitle = document.getElementById("about-section")
      const menu = document.getElementById("menu")
      const drawBtn = document.getElementById("draw")
      const downloadBtn = document.getElementById("download")
      const resetBtn = document.getElementById("reset")
      const form = document.getElementById("generator-form")
      const about = document.getElementById("about")

      charListTitle.onclick = () => { chartable.classList.toggle("collapse") }
      settingBtn.onclick = () => { settingSection.classList.toggle("collapse") }
      generatorSectionTitle.onclick = () => { form.classList.toggle("collapse") }
      aboutSectionTitle.onclick = () => { about.classList.toggle("collapse") }

      resetBtn.onclick = (e) => {
        window.dispatchEvent(new Event('reset'))
        e.preventDefault()
      }
      downloadBtn.onclick = (e) => {
        window.dispatchEvent(new Event('download'))
        e.preventDefault()
      }
      resizeBtn.onclick = (e) => {
        const w = document.getElementById("width").value
        const h = document.getElementById("height").value
        const fsize = document.getElementById("font-size").value
        window.dispatchEvent(new CustomEvent('resize-canvas', { detail: { w,h,fsize }}))
        e.preventDefault()
      }
      clearBtn.onclick = (e) => {
        window.dispatchEvent(new CustomEvent('clear-canvas'))
        e.preventDefault()
      }

      form.onsubmit = (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = {
          title: formData.get("title"),
          artists: formData.get("artists"),
          location: formData.get("location"),
          dates: formData.get("dates"),
          times: formData.get("times"),
          notes: formData.get("notes"),
          width: formData.get("width"),
          height: formData.get("height"),
        }

        window.dispatchEvent(new CustomEvent('generate', { detail: data }));
      }

      run(prog0, { element: output })
        .catch(errorHandler)
        .then((res) => {
          menu.className = "menu ready"
          charsList.map(char => {
            let c = document.createElement("p")
            c.innerText = char
            c.addEventListener("click", () => {
              character.selectChar(char)
            })
            chartable.appendChild(c)
          })

          drawBtn.setAttribute("data-usage", "draw")
        })

      function errorHandler(e) {
        console.warn(e.message)
        console.log(e.error)
      }
    });


  </script>
</body>

</html>